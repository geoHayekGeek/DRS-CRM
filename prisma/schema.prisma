generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminUser {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String   @map("password_hash")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("admin_users")
}

model Driver {
  id                  String               @id @default(uuid())
  fullName            String               @map("full_name")
  profileImageUrl     String?              @map("profile_image_url")
  weight              Float?
  height              Float?
  notes               String?
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  championshipDrivers ChampionshipDriver[]
  groupAssignments    GroupAssignment[]
  sessionResults      SessionResult[]

  @@map("drivers")
}

model Track {
  id              String       @id @default(uuid())
  name            String
  lengthMeters    Float        @map("length_meters")
  location        String?
  layoutImageUrl  String?      @map("layout_image_url")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  rounds          Round[]
  trackImages     TrackImage[]

  @@map("tracks")
}

model TrackImage {
  id        String   @id @default(uuid())
  trackId   String   @map("track_id")
  track     Track    @relation(fields: [trackId], references: [id], onDelete: Cascade)
  imageUrl  String   @map("image_url")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("track_images")
}

model Championship {
  id                 String               @id @default(uuid())
  name               String
  isCurrent          Boolean              @default(false) @map("is_current")
  startDate          DateTime             @map("start_date")
  endDate            DateTime?            @map("end_date")
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  championshipDrivers ChampionshipDriver[]
  rounds             Round[]

  @@map("championships")
}

model ChampionshipDriver {
  id             String       @id @default(uuid())
  championshipId String       @map("championship_id")
  championship   Championship @relation(fields: [championshipId], references: [id], onDelete: Cascade)
  driverId       String       @map("driver_id")
  driver         Driver       @relation(fields: [driverId], references: [id], onDelete: Cascade)
  createdAt      DateTime     @default(now()) @map("created_at")

  @@unique([championshipId, driverId])
  @@map("championship_drivers")
}

model Round {
  id               String            @id @default(uuid())
  name             String
  date             DateTime
  trackId          String            @map("track_id")
  track            Track             @relation(fields: [trackId], references: [id], onDelete: Cascade)
  championshipId   String?           @map("championship_id")
  championship     Championship?     @relation(fields: [championshipId], references: [id], onDelete: Cascade)
  numberOfGroups   Int               @default(4) @map("number_of_groups")
  availableKarts   Int[]             @default([]) @map("available_karts")
  setupCompleted   Boolean           @default(false) @map("setup_completed")
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  sessions         Session[]
  groupAssignments GroupAssignment[]
  roundImages      RoundImage[]

  @@map("rounds")
}

model RoundImage {
  id        String   @id @default(uuid())
  roundId   String   @map("round_id")
  round     Round    @relation(fields: [roundId], references: [id], onDelete: Cascade)
  imageUrl  String   @map("image_url")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("round_images")
}

enum SessionType {
  QUALIFYING
  RACE
  FINAL_QUALIFYING
  FINAL_RACE
}

enum PointsMultiplier {
  NORMAL
  HALF
  DOUBLE
}

model Session {
  id              String            @id @default(uuid())
  roundId         String            @map("round_id")
  round           Round             @relation(fields: [roundId], references: [id], onDelete: Cascade)
  type            SessionType
  group           String?
  order           Int
  pointsMultiplier PointsMultiplier? @map("points_multiplier")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  results         SessionResult[]

  @@map("sessions")
}

model SessionResult {
  id        String   @id @default(uuid())
  sessionId String   @map("session_id")
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  driverId  String   @map("driver_id")
  driver    Driver   @relation(fields: [driverId], references: [id], onDelete: Cascade)
  position  Int
  points    Int
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([sessionId, driverId])
  @@map("session_results")
}

model GroupAssignment {
  id         String   @id @default(uuid())
  roundId    String   @map("round_id")
  round      Round    @relation(fields: [roundId], references: [id], onDelete: Cascade)
  driverId   String   @map("driver_id")
  driver     Driver   @relation(fields: [driverId], references: [id], onDelete: Cascade)
  group      String
  kartNumber Int      @map("kart_number")
  createdAt  DateTime @default(now()) @map("created_at")

  @@unique([roundId, driverId])
  @@map("group_assignments")
}
